language: node_js
node_js: 10.13.0
cache: npm
git:
  depth: 3
addons:
  ssh_known_hosts: jtmorrisbytes.com
before_deploy:
- mkdir ./temp -p
- openssl aes-256-cbc -K $encrypted_fa5cceff5009_key -iv $encrypted_fa5cceff5009_iv -in deploy_rsa.enc -out ./temp/deploy_rsa -d
- eval "$(ssh-agent -s)"
- chmod 600 ./temp/deploy_rsa
- ssh-add ./temp/deploy_rsa
before_install:
- npm i -g @angular/cli

jobs:
  include:
  - stage: test
    script: ng test --no-watch --browsers=ChromeHeadless
  - stage: build-dev
    if: branch = alpha
    script: ./scripts/build-dev.sh
  - stage: build-production
    if: branch = master
    script: ./scripts/build-production.sh
  - stage: build-staging
    if: branch = staging
    script: ./scripts/build-dev.sh
deploy:
  provider: heroku
  skip_cleanup: true
  api_key:
    secure: "1d392c2f-6d53-4ba8-8d92-7142169ccea8"
  app:
    master: jtmorrisbytes
    staging: jtmorrisbytes-staging
    alpha:  jtmorrisbytes-alpha
  on:
    all_branches: true